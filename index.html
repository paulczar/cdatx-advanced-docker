<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>I built a SaaS and I shipped it</title>

		<meta name="description" content="I built a SaaS and I shipped it">
		<meta name="author" content="Paul Czarkowski">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Docker</h1>
					<h3>I built a SaaS and I shipped it</h3>
					<h4>in a single afternoon</h4>
					<p>
						<small>Created by <a href="http://tech.paulcz.net">Paul Czarkowski</a> / <a href="http://twitter.com/pczarkowski">@pczarkowski</a></small>
					</p>
				</section>

				<section>
					<h2>About Me</h2>
				</section>

				<section>
					<h2>Australian...</h2>
 					<p><img src="images/aussie.jpg"><br>
				</section>

				<section>
					<h2>SysAdmin...</h2>
 					<p><img src="images/sysadmin.jpg"><br>
				</section>

				<section>
					<h2>Corporate slave...</h2>
					<span class="fragment">
					<p>But not your typical corporation ...
 					<p><img src="images/bf4.jpg"><br>
 					</span>
				</section>


				<section>
					<h2>Chef hacker...</h2>
 					<p><img src="images/Chef_Logo.png" width="25%"><br>
 					<a href="https://github.com/paulczar/cookbook-openstack-docker">https://github.com/paulczar/cookbook-openstack-docker</a>
				</section>

				<section>
					<h2>Also the other kind of Chef...</h2>
 					<p><img src="images/popup.jpg" width="50%">
				</section>

				<section>
					<h2>Best Queso in Austin - 2013</h2>
 					<p><img src="images/queso.jpg" width="50%">
				</section>

				<section>
					<h2>And A Docker Hacker...</h2>
 					<p><img src="images/docker-repo.png" width="75%">
				</section>

				<section>
					<h2>What is docker anyway?</h2>
 					<p>Urbandictionary.com describes docking as ...
 					<blockquote class="fragment">a verb describing the act of stretching one mans...</blockquote>
				</section>

				<section>
					<h2>What is docker anyway?</h2>
 					<p><img src="images/docker.png">
				</section>

				<section>
					<h2>The Problem</h2>
 					<h3>I want a persistent IRC connection</h3>
 					<ul>
 						<li>That is connected even when I'm not.
 						<li>That I can connect from any of my machines.
 						<li>That I can read back on conversations I wasn't around for.
 					</ul>
				</section>

				<section>
					<p align="left">There's an OSS App for that - <a href="http://wiki.znc.in/ZNC">http://wiki.znc.in/ZNC</a>
					<p><q>But I don't want to have to run a server.</q>
					<p align="left">There's a SaaS for that - <a href="http://ircrelay.com">http://ircrelay.com</a>
					<p><q>But I don't want to pay $5 a month because I'm cheap.</q><br><br>
				  <h3 class="fragment">I bet I could build a SaaS IRC Bouncer using docker...</h3>
				</section>

				<section>
					<h3>First...  Build a docker container to run ZNC</h3>
					<p><a href="https://github.com/paulczar/docker-znc">https://github.com/paulczar/docker-znc</a>
				</section>

				<section>	
				  <h3>Dockerfile</h3>				
					<pre class="stretch"><code>
# This file creates a container that runs ZNC
#
# Author: Paul Czarkowski
# Date: 08/04/2013


FROM ubuntu:12.10
MAINTAINER Paul Czarkowski "paul@paulcz.net"

RUN apt-get update
RUN apt-get -y install znc

ADD start-znc /usr/local/bin/start-znc
ADD znc.pem /opt/znc/znc.pem
ADD znc.conf /opt/znc/configs/znc.conf

RUN chmod +x /usr/local/bin/start-znc

RUN useradd znc
RUN chown -R znc:znc /opt/znc

EXPOSE 6667

# Start znc
CMD ["start-znc"]
					</code></pre>					
				</section>

				<section>		
				  <h3>start-znc</h3>			
					<pre class="stretch"><code>
#!/bin/bash

ZNC_USER=${ZNC_USER:-$(tr -dc "[:alpha:]" < /dev/urandom | head -c 8)}
ZNC_PASS=${ZNC_PASS:-$(tr -dc "[:alpha:]" < /dev/urandom | head -c 8)}
IRC_SERVER=${IRC_SERVER:-'irc.freenode.net'}
IRC_PORT=${IRC_PORT:-'6667'}


ZNC_SALT="$(dd if=/dev/urandom bs=16c count=1 | md5sum | awk '{print $1}')"
ZNC_HASH="sha256#$(echo -n ${ZNC_PASS}${ZNC_SALT} | sha256sum | awk '{print $1}')#$ZNC_SALT#"

sed -i "s/ZNC_USER/$ZNC_USER/" /opt/znc/configs/znc.conf
sed -i "s/ZNC_HASH/$ZNC_HASH/" /opt/znc/configs/znc.conf
sed -i "s/IRC_SERVER/$IRC_SERVER/" /opt/znc/configs/znc.conf
sed -i "s/IRC_PORT/$IRC_PORT/" /opt/znc/configs/znc.conf

znc -f -r -d /opt/znc
					</code></pre>					
				</section>

				<section>		
				  <h3>Run it!</h3>			
					<pre><code>
$ docker run -e ZNC_USER=paultest -e ZNC_PASS=paultest \
      -p 6667 -u znc paulczar/znc start-znc
Connecting to IRC Server: irc.freenode.net:6667
ZNC User: paultest
ZNC Pass: paultest
Opening Config [/opt/znc/configs/znc.conf]... 
Loading Global Module [lastseen]... [/usr/lib/znc/lastseen.so]
Binding to port [+6667] using ipv4... 
Loading user [paultest]
Adding Server [irc.freenode.net 6667]... 
					</code></pre>					
				</section>

				<section>
				<h2>That was easy ... now write a web app</h2>
				<p>I'm going to be ultra cool and use Node and Mongo!
				<ul>
				 <li class="fragment">Install Node.JS
				 <li class="fragment">Install MongoDB
				 <li class="fragment">Find an Auth library to auth against google.
				 <li class="fragment">...
				 <li class="fragment">...
				 <li class="fragment">I just remembered ...  I'm a shit programmer.
				</section>

				<section>
				<h2>Back to the drawing board...</h2>
				<p class="fragment">Hey look this guy has done something similar for memcached...
				<br><img src="images/memcached.png">
				</section>

				<section>
				<h2>It's not stealing if you fork...</h2>
				<p><img src="images/memcached-fork.png">
				</section>

				<section>
					<h2>Turns out its a fairly simply app</h2>
					<ul>
						<li>Ruby on Rails
						<li>Active Record
						<li>Calls docker CLI with backtick commands.
						<li class="fragment">A retard like me can understand it... just.
					</ul>
				</section>

				<section>
					<h2>Add Vagrant + Berkshelf / Chef</h2>
					<pre class="stretch"><code>
# -*- mode: ruby -*-
# vi: set ft=ruby :

require "vagrant"

if Vagrant::VERSION < "1.2.1"
  raise "Use a newer version of Vagrant (1.2.1+)"
end


# Allows us to pick a different box by setting Environment Variables
BOX_NAME = ENV['BOX_NAME'] || "precise64"
BOX_URI = ENV['BOX_URI'] || "https://opscode-vm-bento.s3.amazonaws.com/vagrant/opscode_ubuntu-12.04_provisionerless.box"

Vagrant.configure("2") do |config|
  # Cachier - speeds up subsequent runs.
  # vagrant plugin install vagrant-cachier
  config.cache.auto_detect = true
  #config.cache.enable_nfs  = true
  config.berkshelf.enabled = true
  # Ensure Chef 11.x is installed for provisioning
  config.omnibus.chef_version = :latest

  config.vm.define :SaasZNC do |config|
    config.vm.hostname = "SaasZNC"
    config.vm.box = BOX_NAME
    config.vm.box_url = BOX_URI
    config.vm.network :private_network, ip: "33.33.33.33"
    config.vm.network :forwarded_port, guest: 3000, host: 3000
    config.ssh.max_tries = 40
    config.ssh.timeout   = 120
    config.ssh.forward_agent = true
    config.vm.provision :chef_solo do |chef|
      chef.provisioning_path = "/tmp/vagrant-cache"
      chef.json = {
          "languages" => {
            "ruby" => {
              "default_version" => "1.9.1"
            }
          }
      }
      chef.run_list = [
        "recipe[apt::default]",
        "recipe[ruby::default]",
        "recipe[build-essential::default]",
        "recipe[git::default]",
        "recipe[docker::default]"
      ]
    end

    config.vm.provision :shell, :inline => <<-SCRIPT
      groupadd docker
      usermod -a -G docker vagrant
      apt-get -y -q install libxslt-dev libxml2-dev libpq-dev sqlite3 libsqlite3-dev
      gem install bundler --no-ri --no-rdoc
      cd /vagrant
      bundle install
      rake db:migrate
      rails server -d

    SCRIPT
    config.vm.provider :virtualbox do |vb|
      vb.customize ["modifyvm", :id, "--cpus", 2]
      vb.customize ["modifyvm", :id, "--memory", 2048]
    end
  end
end

					</pre class="stretch"></code>
				</section>

				<section>
					<h2>Over the course of the next hour...</h2>
					<ul>
						<li class="fragment">Working prototype in Vagrant
						<li class="fragment">Create Rackspace public cloud instance <br><i>(&lt;3 dev free cloud promo)</i>i>
						<li class="fragment">Config server using Chef Enterprise <i>(5 servers free)</i>
						<li class="fragment">Upload code with scp
						<li class="fragment">rails server -d -e production
						<li class="fragment">http://znc.paulcz.net
				</section>

				<section>
					<img src="images/znc_saas1.png">
				</section>

				<section>
					<img src="images/znc_saas2.png">
				</section>

				<section>
				  <h2>Stress Test</h2>
				  <pre><code>
for i in {1..100}; do 
	docker run -e ZNC_USER=znctest$i -e ZNC_PASS=znctest$i -d -p 6667 -u znc paulczar/znc start-znc
done
				  </code></pre>
				  <p>A 512mb instance runs 100 ZNC containers without stress...
				  <br>Would probably handle a lot more ...
				</section>

				<section>
					<h3>but IRCops aren't amused...</h3>
					<img src="images/ircop.png" width="125%">
				</section>

				<section>
					<h2>Live Demo!</h2>
					<img src="images/livedemo.jpg">
				</section>


				<section>
					<h2>Links</h2>
					<ul>
						<li><a href="http://docker.io">Docker</a></li>
						<li><a href="http://www.memcachedasaservice.com/">Example Memcached SaaS using docker</a></li>
						<li><a href="http://znc.paulcz.net">my ZNC SaaS</a></li>
						<li><a href="http://www.vagrantup.com/">Vagrant</a></li>
						<li><a href="http://developer.rackspace.com/devtrial/">Rackspace &lt;3 Developers Free Trial</a></li>
						<li><a href="https://www.facebook.com/events/231601060322589/">East Austin Oaxaca Popup</a>
					</ul>
				</section>

				<section>
					<h1>THE END</h1>
					<h3>BY Paul Czarkowski  / @pczarkowski </h3>
				</section>

				<section>
					<h2>ps Come eat my food</h2>
 					<p><img src="images/popup.jpg" width="50%">
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
