<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Container Days ATX - Advanced Docker Training</title>

		<meta name="description" content="description of presentation">
		<meta name="author" content="Paul Czarkowski">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/simple.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-35638296-2', 'auto');
  ga('send', 'pageview');

</script>
		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h2>Container Days ATX</h2>
					<h3>Advanced Docker Training</h3>
					<p>
						<small>Created by <a href="http://tech.paulcz.net">Paul Czarkowski</a> / <a href="http://twitter.com/pczarkowski">@pczarkowski</a></small>
					</p>
				</section>

				<section>
					<h2>Who Am I ?</h2>
 					<p><img src="images/sysadmin.jpg"><br>
				</section>

				<section>
					<h2>Agenda</h2>
					<br><br>
 					<ul>
 						<li>Optimizing Dockerfiles
 						<li>Docker vs Config Management
 						<li>Logging, Monitoring, and Metrics
 						<li>Running multiple processes in a container
 						<li>App Configuration via ENV or service discovery
 						<li>Demo / Workshop
 					</ul>
				</section>

				<section>
					<h2>Agenda</h2>
					<br><br>
 					<ul>
 						<li><b>Optimizing Dockerfiles</b>
 						<li>Docker vs Config Management
 						<li>Logging, Monitoring, and Metrics
 						<li>Running multiple processes in a container
 						<li>App Configuration via ENV or service discovery
 					</ul>
				</section>

				<section>
				  <h2>Optimizing Dockerfiles</h2>
					<br><br>
				  <p><a href="http://tech.paulcz.net/2015/03/optimizing-your-dockerfiles/">Blog Post</a>
				</section>

				<section>
				  <h2>Optimizing Dockerfiles</h2>
					<br><br>
				  <ul>
				    <li>Docker images are “supposed” to be small and fast.
				    <li>Software is complicated, languages like Python/Ruby can result in large images.
				    <li>Dockerfile != $ curl | sudo bash
				</section>

				<section>
				  <h2>Optimizing Dockerfiles</h2>
<pre class="stretch"><code>
FROM ubuntu:latest

ADD . /home/docker

ADD https://dist.torproject.org/torbrowser/4.0.4/tor-browser-linux64-4.0.4_en-US.tar.xz /home/docker/tor.tar.xz

RUN apt-get update && true

ENV DEBIAN_FRONTEND noninteractive

RUN apt-get install -y firefox

RUN localedef -v -c -i en_US -f UTF-8 en_US.UTF-8 || :

RUN useradd -m -d /home/docker docker

RUN cd /home/docker && tar xJf /home/docker/tor.tar.xz

USER docker

CMD ["/home/docker/tor-browser_en-US/start-tor-browser"]
</code></pre>
				</section>


				<section>
				  <h2>Optimizing Dockerfiles</h2>
				  <h3>Order Matters</h3>
					<br><br>
				  <p>Optimizing your Dockerfile for build cache hits.
					<br><br>
				  <ul>
				    <li>The more cache hits the faster the build
				    <li>First command to change invalidates all cache
				    <li>Smart ordering can save minutes
				</section>

				<section>
				  <h2>Optimizing Dockerfiles</h2>
				  <h3>Order Matters</h3>
					<br><br>
				  <p>Sort your commands by
					<br><br>
				  <ol>
				  	<li>Sharable with other images
				  	<li>Frequency of change
				  	<li>Time to run
				</section>


				<section>
				  <h2>Optimizing Dockerfiles</h2>
				  <h3>Know your commands</h3>
					<br><br>
				  <ul>
				    <li><b>ADD</b> always invalidates cache
				    <li><b>WORKDIR</b>, <b>CMD</b> are cheap
				</section>

				<section>
				  <h2>Optimizing Dockerfiles</h2>
				  <h3>Choose your base images wisely</h3>
					<br><br>
				  <ul>
				    <li>Remember you're using a layered FS
				    <li>ubuntu:trusty + busybox > 2 x Ubuntu:trusty
				</section>

				<section>
				  <h2>Optimizing Dockerfiles</h2>
				  <h3>Layers are your friend</h3>
					<br><br>
				  <ul>
				    <li>Each command is a layer
				    <li>Join <b>RUN</b> commands together with <b>&& \</b>
				    <li>A shared layer is free for subsequent containers.
				    <li>Create your own common base image from when lots of shared layers.
				</section>

				<section>
				  <h2>Optimizing Dockerfiles</h2>
				  <h3>Cheat!</h3>
					<br><br>
				  <ul>
				    <li>Add new changes to bottom of Dockerfile
				    <li>Once locked in, then move them up.
				</section>

				<section>
				  <h2>Optimizing Dockerfiles</h2>
				  <h3>Volume Containers</h3>
					<br><br>
				  <p>Use the image of the application that is consuming it as the base for the volume container.</p>
					<br><br>
				  <ul>
				    <li>It's free because it's shared.
				    <li>Volume container now contains the Data <i>and</i> the Application.
				</section>

				<section>
				<img src="images/pop-quiz-hotshot.jpg">
				</section>

				<section>
				  <h2>Optimizing Dockerfiles</h2>
<pre class="stretch"><code>
FROM ubuntu:latest

ADD . /home/docker

ADD https://dist.torproject.org/torbrowser/4.0.4/tor-browser-linux64-4.0.4_en-US.tar.xz /home/docker/tor.tar.xz

RUN apt-get update && true

ENV DEBIAN_FRONTEND noninteractive

RUN apt-get install -y firefox

RUN localedef -v -c -i en_US -f UTF-8 en_US.UTF-8 || :

RUN useradd -m -d /home/docker docker

RUN cd /home/docker && tar xJf /home/docker/tor.tar.xz

USER docker

CMD ["/home/docker/tor-browser_en-US/start-tor-browser"]
</code></pre>
				</section>

				<section>
				  <h2>Optimizing Dockerfiles</h2>
					<br><br>
					<br><br>
				  <p>Walkthrough example Dockerfiles on blog...
				</section>

				<section>
					<h2>Agenda</h2>
					<br><br>
 					<ul>
 						<li>Optimizing Dockerfiles
 						<li><b>Docker vs Config Management</b>
 						<li>Logging, Monitoring, and Metrics
 						<li>Running multiple processes in a container
 						<li>App Configuration via ENV or service discovery
 						<li>Demo / Workshop
 					</ul>
				</section>

				<section>
					<h2>Docker vs Config Management</h2>
					<br><br>
					<p>"I don't need Config Management now that I have Docker."
				</section>

				<section>
					<h2>Docker vs Config Management</h2>
					<br><br><img src="images/cm_killer.png">
				</section>

				<section>
					<h2>Docker vs Config Management</h2>
					<br><br>
					<p>You probably shouldn't be trusting docker [yet] for managing long term persistent data.
					<br><br>
					<ul>
					  <li>Volume Containers
					  <li>Volume mounts from Host
					</ul>
				</section>

				<section>
					<h2>Docker vs Config Management</h2>
					<br><br>
					<p>Persistent data stores and other infrastructure services have to be managed by something.
					<br><br>
					<ul>
					  <li>Chef recipes to spin up databases, Key Value stores, etc.
					  <li>Ansible or Cloud Formations for RDS, ELB, etc.
				</section>

				<section>
					<h2>Docker vs Config Management</h2>
					<h3>Chef and Docker</h3>
					<br><br>
					[the tools, not the companies]<br>have a great history of working together.
					<p><a href="https://supermarket.chef.io/cookbooks/docker">https://supermarket.chef.io/cookbooks/docker</a>
					<br><br>
					<pre><code>include_recipe "docker::default"</code></pre>
				</section>

				<section>
					<h2>Docker vs Config Management</h2>
					<pre class='stretch'><code>
docker_image 'registry' do
  action [:pull]
end

docker_container 'registry' do
  detach  true
  port    '5000:5000'
  action [:run]
end

node['my_app']['images'].each do |image|
  docker_image image do
    action [:pull]
  end
  docker_image image do
    repository "#{node['my_app']['registry']}/#{image}"
    registry   node['my_app']['registry']
    action [:tag, :push]
  end
end
</code></pre>
				</section>

				<section>
					<h2>Docker vs Config Management</h2>
					<pre class='stretch'><code>
git "#{Chef::Config[:file_cache_path]}/docker-testcontainerd" do
  repository 'git@github.com:bflad/docker-testcontainerd.git'
  notifies :build, 'docker_image[tduffield/testcontainerd]', :immediately
end

docker_image 'tduffield/testcontainerd' do
  action :pull_if_missing
end
					</code></pre>
				</section>

				<section>
					<h2>Docker vs Config Management</h2>
					<br><br>
					<p>Almost anything that can be done with docker can be done via the docker cookbook.
					<p>Puppet and Ansible both have a similar story.
				</section>

				<section>
					<h2>Docker vs Config Management</h2>
					<h3>Config Management in the container ?</h3>
					<br><br>
					  <p>You probably shouldn't...
					  <br>But if it makes sense in your use case ... go for it.
					  <br><br>Consider <a href="https://docs.chef.io/containers.html">Chef for Containers</a> if you want to do this, it will
					  help deal with managing services etc.
				</section>

				<section>
					<h2>Docker vs Config Management</h2>
					<h3>Config Management to build images ?</h3>
					<br><br>
					<p>If you're already using a tool like Packer to create images with Config Management, you can probably switch it to build Docker images very easily.
				</section>


				<section>
					<h2>Agenda</h2>
					<br><br>
 					<ul>
 						<li>Optimizing Dockerfiles
 						<li>Docker vs Config Management
 						<li><b>Logging, Monitoring, and Metrics</b>
 						<li>Running multiple processes in a container
 						<li>App Configuration via ENV or service discovery
 						<li>Demo / Workshop
 					</ul>
				</section>

				<section>
					<h2>Agenda</h2>
					<br><br>
 					<ul>
 						<li>Optimizing Dockerfiles
 						<li>Docker vs Config Management
 						<li>Logging, Monitoring, and Metrics
 						<li><b>Running multiple processes in a container</b>
 						<li>App Configuration via ENV or service discovery
 						<li>Demo / Workshop
 					</ul>
				</section>

				<section>
					<h2>Agenda</h2>
					<br><br>
 					<ul>
 						<li>Optimizing Dockerfiles
 						<li>Docker vs Config Management
 						<li>Logging, Monitoring, and Metrics
 						<li>Running multiple processes in a container
 						<li><b>App Configuration via ENV or service discovery</b>
 						<li>Demo / Workshop
 					</ul>
				</section>

				<section>
					<h2>Agenda</h2>
					<br><br>
 					<ul>
 						<li>Optimizing Dockerfiles
 						<li>Docker vs Config Management
 						<li>Logging, Monitoring, and Metrics
 						<li>Running multiple processes in a container
 						<li>App Configuration via ENV or service discovery
 						<li><b>Demo / Workshop</b>
 					</ul>
				</section>

				<section>
					<h2>Links</h2>
					<p><a href="http://tech.paulcz.net">http://tech.paulcz.net</a></p><br>
					<ul>
						<li><a href="http://tech.paulcz.net">Link 1</a></li>
					</ul>
				</section>

				<section>
					<h1>THE END</h1>
					<h3>BY Paul Czarkowski  / @pczarkowski </h3>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
